SELECT load_extension( 'stgeometry_sqlite.dll', 'SDE_SQL_funcs_init');
INSERT INTO GDB_Items("ObjectID", "UUID", "Type", "Name", "PhysicalName", "Path", "Url", "Properties", "Defaults", "DatasetSubtype1", "DatasetSubtype2", "DatasetInfo1", "DatasetInfo2", "Definition", "Documentation", "ItemInfo", "Shape") select MAX(ObjectID)+1, '{7B6EB064-7BF6-42C8-A116-2E89CD24A000}', '{5B966567-FB87-4DDE-938B-B4B37423539D}', 'MyReplica', 'MYREPLICA', 'MyReplica', '', 1, NULL, NULL, NULL, 'http://collector-reais.rhcloud.com/arcgis/rest/services/bristowward/FeatureServer', 'shale','<GPSyncReplica xsi:type=''typens:GPSyncReplica'' xmlns:xsi=''http://www.w3.org/2001/XMLSchema-instance'' xmlns:xs=''http://www.w3.org/2001/XMLSchema'' xmlns:typens=''http://www.esri.com/schemas/ArcGIS/10.3''><ReplicaName>MyReplica</ReplicaName><ID>1</ID><ReplicaID>{7b6eb064-7bf6-42c8-a116-2e89cd24a000}</ReplicaID><ServiceName>http://collector-reais.rhcloud.com/arcgis/rest/services/bristowward/FeatureServer</ServiceName><Owner>shale</Owner><Role>esriReplicaRoleChild</Role><SyncModel>esriSyncModelPerLayer</SyncModel><Direction>esriSyncDirectionBidirectional</Direction><CreationDate>2017-08-08T16:05:58</CreationDate><LastSyncDate>1970-01-01T00:00:01</LastSyncDate><ReturnsAttachments>true</ReturnsAttachments><SpatialRelation>esriSpatialRelIntersects</SpatialRelation><QueryGeometry xsi:type=''typens:PolygonN''><HasID>false</HasID><HasZ>false</HasZ><HasM>false</HasM><Extent xsi:type=''typens:EnvelopeN''><XMin>-8636545.21205</XMin><YMin>4664046.39148</YMin><XMax>-8610898.279</XMax><YMax>4685963.30479</YMax></Extent><RingArray xsi:type=''typens:ArrayOfRing''><Ring xsi:type=''typens:Ring''><PointArray xsi:type=''typens:ArrayOfPoint''><Point xsi:type=''typens:PointN''><X>-8636545.21205</X><Y>4664046.39148</Y></Point><Point xsi:type=''typens:PointN''><X>-8610898.279</X><Y>4664046.39148</Y></Point><Point xsi:type=''typens:PointN''><X>-8610898.279</X><Y>4685963.30479</Y></Point><Point xsi:type=''typens:PointN''><X>-8636545.21205</X><Y>4685963.30479</Y></Point><Point xsi:type=''typens:PointN''><X>-8636545.21205</X><Y>4664046.39148</Y></Point></PointArray></Ring></RingArray><SpatialReference xsi:type=''typens:ProjectedCoordinateSystem''><WKT>PROJCS[&quot;WGS_1984_Web_Mercator_Auxiliary_Sphere&quot;,GEOGCS[&quot;GCS_WGS_1984&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],PRIMEM[&quot;Greenwich&quot;,0.0],UNIT[&quot;Degree&quot;,0.0174532925199433]],PROJECTION[&quot;Mercator_Auxiliary_Sphere&quot;],PARAMETER[&quot;False_Easting&quot;,0.0],PARAMETER[&quot;False_Northing&quot;,0.0],PARAMETER[&quot;Central_Meridian&quot;,0.0],PARAMETER[&quot;Standard_Parallel_1&quot;,0.0],PARAMETER[&quot;Auxiliary_Sphere_Type&quot;,0.0],UNIT[&quot;Meter&quot;,1.0],AUTHORITY[&quot;EPSG&quot;,3857]]</WKT><XOrigin>-20037700</XOrigin><YOrigin>-30241100</YOrigin><XYScale>10000</XYScale><ZOrigin>-100000</ZOrigin><ZScale>10000</ZScale><MOrigin>-100000</MOrigin><MScale>10000</MScale><XYTolerance>0.001</XYTolerance><ZTolerance>0.001</ZTolerance><MTolerance>0.001</MTolerance><HighPrecision>true</HighPrecision><WKID>102100</WKID><LatestWKID>3857</LatestWKID></SpatialReference></QueryGeometry><GPSyncDatasets xsi:type=''typens:ArrayOfGPSyncDataset''><GPSyncDataset xsi:type=''typens:GPSyncDataset''><DatasetID>'||(SELECT ObjectId FROM "GDB_Items" Where Name='main.members_gis')||'</DatasetID><DatasetName>members_gis</DatasetName><DatasetType>esriDTFeatureClass</DatasetType><LayerID>0</LayerID><LayerName>members_gis</LayerName><Direction>esriSyncDirectionBidirectional</Direction><ReplicaServerGen xsi:type=''xs:long''>53052</ReplicaServerGen><ReplicaClientDownloadGen xsi:type=''xs:long''>1000</ReplicaClientDownloadGen><ReplicaClientUploadGen xsi:type=''xs:long''>1000</ReplicaClientUploadGen><ReplicaClientAcknowledgeUploadGen xsi:type=''xs:long''>1000</ReplicaClientAcknowledgeUploadGen><UseGeometry>true</UseGeometry><IncludeRelated>true</IncludeRelated><QueryOption>esriRowsTypeFilter</QueryOption></GPSyncDataset></GPSyncDatasets><AttachmentsSyncDirection>esriAttachmentsSyncDirectionBidirectional</AttachmentsSyncDirection></GPSyncReplica>', NULL, NULL, NULL from GDB_Items;;
INSERT INTO GDB_Items("ObjectID", "UUID", "Type", "Name", "PhysicalName", "Path", "Url", "Properties", "Defaults", "DatasetSubtype1", "DatasetSubtype2", "DatasetInfo1", "DatasetInfo2", "Definition", "Documentation", "ItemInfo", "Shape") select MAX(ObjectID)+1, (select upper('{' || substr(u,1,8)||'-'||substr(u,9,4)||'-4'||substr(u,13,3)||'-'||v||substr(u,17,3)||'-'||substr(u,21,12)||'}') from (select lower(hex(randomblob(16))) as u, substr('89ab',abs(random()) % 4 + 1, 1) as v)), '{D86502F9-9758-45C6-9D23-6DD1A0107B47}', 'members_gis', 'MEMBERS_GIS', 'MyReplica\members_gis', '', 1, NULL, NULL, NULL, NULL, NULL, '<GPSyncDataset xsi:type=''typens:GPSyncDataset'' xmlns:xsi=''http://www.w3.org/2001/XMLSchema-instance'' xmlns:xs=''http://www.w3.org/2001/XMLSchema'' xmlns:typens=''http://www.esri.com/schemas/ArcGIS/10.3''><DatasetID>'||(SELECT ObjectId FROM "GDB_Items" Where Name='main.members_gis')||'</DatasetID><DatasetName>members_gis</DatasetName><DatasetType>esriDTFeatureClass</DatasetType><LayerID>0</LayerID><LayerName>members_gis</LayerName><Direction>esriSyncDirectionBidirectional</Direction><ReplicaServerGen xsi:type=''xs:long''>53052</ReplicaServerGen><ReplicaClientDownloadGen xsi:type=''xs:long''>1000</ReplicaClientDownloadGen><ReplicaClientUploadGen xsi:type=''xs:long''>1000</ReplicaClientUploadGen><ReplicaClientAcknowledgeUploadGen xsi:type=''xs:long''>1000</ReplicaClientAcknowledgeUploadGen><UseGeometry>true</UseGeometry><IncludeRelated>true</IncludeRelated><QueryOption>esriRowsTypeFilter</QueryOption></GPSyncDataset>', NULL, NULL, NULL from GDB_Items;
;
UPDATE "GDB_ServiceItems" set "DatasetName"="members_gis" where "ItemId"=0;
alter table members_gis rename to members_gis_org;
CREATE TABLE members_gis (OBJECTID int32, name text(8000) check((typeof(name) = 'text' or typeof(name) = 'null') and not length(name) > 8000), address text(8000) check((typeof(address) = 'text' or typeof(address) = 'null') and not length(address) > 8000), latitude float64 check(typeof(latitude) = 'real' or typeof(latitude) = 'null'), longitude float64 check(typeof(longitude) = 'real' or typeof(longitude) = 'null'), phone text(8000) check((typeof(phone) = 'text' or typeof(phone) = 'null') and not length(phone) > 8000), GlobalID uuidtext check(typeof(GlobalID) = 'text' and length(GlobalID) = 38), created_user text(255) check((typeof(created_user) = 'text' or typeof(created_user) = 'null') and not length(created_user) > 255), created_date realdate check((typeof(created_date) = 'real' or typeof(created_date) = 'null') and created_date >= 0.0), last_edited_user text(255) check((typeof(last_edited_user) = 'text' or typeof(last_edited_user) = 'null') and not length(last_edited_user) > 255), last_edited_date realdate check((typeof(last_edited_date) = 'real' or typeof(last_edited_date) = 'null') and last_edited_date >= 0.0), idstr text(50) check((typeof(idstr) = 'text' or typeof(idstr) = 'null') and not length(idstr) > 50), Shape geometryblob check((typeof(Shape) = 'blob' and length(Shape) >= 18 and cast(hex(substr(Shape,1,1)) as integer) = 64) or typeof(Shape) = 'null'), gdb_archive_oid integer primary key not null, gdb_from_date realdate check(typeof(gdb_from_date) = 'real' and gdb_from_date >= 0.0) default (julianday('now')), gdb_to_date realdate check(typeof(gdb_to_date) = 'real' and gdb_to_date >= 0.0) default (julianday ('9999-12-31 23:59:59'))) ;
INSERT INTO GDB_ColumnRegistry("table_name", "column_name", "sde_type", "column_size", "decimal_digits", "description", "object_flags", "object_id") values('members_gis','gdb_from_date',7,0,NULL,'Archiving from date.',536870912,NULL);
INSERT INTO GDB_ColumnRegistry("table_name", "column_name", "sde_type", "column_size", "decimal_digits", "description", "object_flags", "object_id") values('members_gis','gdb_to_date',7,0,NULL,'Archiving to date.',536870912,NULL);
INSERT INTO GDB_ColumnRegistry("table_name", "column_name", "sde_type", "column_size", "decimal_digits", "description", "object_flags", "object_id") values('members_gis','gdb_archive_oid',2,0,NULL,'Archiving record unique id.',536870912,NULL);
INSERT INTO "GDB_ItemRelationships"("ObjectID", "UUID", "Type", "OriginID", "DestID", "Properties", "Attributes")VALUES((select max(OBJECTID) + 1 from "GDB_ItemRelationships"),(select upper('{' || substr(u,1,8)||'-'||substr(u,9,4)||'-4'||substr(u,13,3)||'-'||v||substr(u,17,3)||'-'||substr(u,21,12)||'}') from (select lower(hex(randomblob(16))) as u, substr('89ab',abs(random()) % 4 + 1, 1) as v)),(select UUID from "GDB_ItemRelationshipTypes" where "Name"= 'DatasetOfSyncDataset' limit 1),(select UUID from "GDB_Items" where Name="members_gis" limit 1),(select UUID from "GDB_Items" where Name="main.members_gis" limit 1),1,NULL);
INSERT INTO "GDB_ItemRelationships"("ObjectID", "UUID", "Type", "OriginID", "DestID", "Properties", "Attributes") VALUES((select max(OBJECTID) + 1 from "GDB_ItemRelationships"),(select upper('{' || substr(u,1,8)||'-'||substr(u,9,4)||'-4'||substr(u,13,3)||'-'||v||substr(u,17,3)||'-'||substr(u,21,12)||'}') from (select lower(hex(randomblob(16))) as u, substr('89ab',abs(random()) % 4 + 1, 1) as v)),(select UUID from "GDB_ItemRelationshipTypes" where "Name"='DatasetOfSyncDataset' limit 1),(select UUID from "GDB_Items" where Name="MyReplica" limit 1),(select UUID from "GDB_Items" where Name="members_gis" limit 1),1,NULL);
CREATE VIEW members_gis_evw AS SELECT OBJECTID,name,address,latitude,longitude,phone,Shape,GlobalID,created_user,created_date,last_edited_user,last_edited_date,idstr FROM members_gis WHERE gdb_to_date BETWEEN (julianday ('9999-12-31 23:59:59') - 0.000000001) AND (julianday ('9999-12-31 23:59:59') + 0.000000001);
CREATE TRIGGER members_gis_evw_delete INSTEAD OF DELETE ON members_gis_evw BEGIN DELETE FROM members_gis WHERE OBJECTID = OLD.OBJECTID AND gdb_from_date BETWEEN (julianday('now') - 0.000000001) AND (julianday('now') + 0.000000001); UPDATE OR REPLACE members_gis SET gdb_to_date = julianday('now') WHERE OBJECTID = OLD.OBJECTID AND gdb_to_date BETWEEN (julianday ('9999-12-31 23:59:59') - 0.000000001) AND (julianday ('9999-12-31 23:59:59') + 0.000000001); END;;
CREATE TRIGGER members_gis_evw_insert INSTEAD OF INSERT ON members_gis_evw BEGIN INSERT INTO members_gis (OBJECTID,name,address,latitude,longitude,phone,Shape,GlobalID,created_user,created_date,last_edited_user,last_edited_date,idstr,gdb_from_date,gdb_to_date) VALUES (coalesce (NEW.OBJECTID,(select max(OBJECTID)+1 from 'members_gis'),1),NEW.name,NEW.address,NEW.latitude,NEW.longitude,NEW.phone,NEW.Shape,NEW.GlobalID,NEW.created_user,NEW.created_date,NEW.last_edited_user,NEW.last_edited_date,NEW.idstr,julianday('now'),julianday ('9999-12-31 23:59:59')); END;;
CREATE TRIGGER members_gis_evw_update INSTEAD OF UPDATE ON members_gis_evw BEGIN UPDATE OR IGNORE members_gis SET gdb_to_date = julianday('now') WHERE OBJECTID = OLD.OBJECTID AND gdb_to_date BETWEEN (julianday ('9999-12-31 23:59:59') - 0.000000001) AND (julianday ('9999-12-31 23:59:59') + 0.000000001);REPLACE INTO members_gis (OBJECTID,name,address,latitude,longitude,phone,Shape,GlobalID,created_user,created_date,last_edited_user,last_edited_date,idstr,gdb_from_date,gdb_to_date) VALUES (NEW.OBJECTID,NEW.name,NEW.address,NEW.latitude,NEW.longitude,NEW.phone,NEW.Shape,NEW.GlobalID,NEW.created_user,NEW.created_date,NEW.last_edited_user,NEW.last_edited_date,NEW.idstr,(SELECT MAX (gdb_to_date) FROM members_gis WHERE OBJECTID = OLD.OBJECTID AND gdb_to_date < julianday ('9999-12-31 23:59:59')),julianday ('9999-12-31 23:59:59')); END;;
insert into members_gis(OBJECTID,name,address,latitude,longitude,phone,Shape,GlobalID,created_user,created_date,last_edited_user,last_edited_date,idstr) select OBJECTID,name,address,latitude,longitude,phone,Shape,GlobalID,created_user,created_date,last_edited_user,last_edited_date,idstr from members_gis_org;
drop table members_gis_org;
CREATE INDEX gdb_ct4_1 ON members_gis (OBJECTID,gdb_from_date) ;
CREATE INDEX gdb_ct1_1 ON members_gis (gdb_from_date,gdb_to_date) ;
CREATE INDEX r1_gdb_xpk ON members_gis (OBJECTID,gdb_to_date) ;
CREATE INDEX UUID1 ON members_gis (GlobalID) ;
CREATE TRIGGER "st_delete_trigger_members_gis_SHAPE" AFTER DELETE ON members_gis FOR EACH ROW BEGIN DELETE FROM "st_spindex__members_gis_SHAPE" WHERE pkid = OLD._ROWID_; END;
CREATE TRIGGER "st_insert_trigger_members_gis_SHAPE" AFTER INSERT ON members_gis FOR EACH ROW BEGIN SELECT InsertIndexEntry ("st_spindex__members_gis_SHAPE",NEW.SHAPE,NEW._ROWID_,2); END;
CREATE TRIGGER "st_update1_trigger_members_gis_SHAPE" AFTER UPDATE OF SHAPE ON members_gis WHEN OLD._ROWID_ != NEW._ROWID_ BEGIN DELETE FROM "st_spindex__members_gis_SHAPE" WHERE pkid = OLD._ROWID_; SELECT UpdateIndexEntry ("st_spindex__members_gis_SHAPE",NEW.SHAPE,NEW._ROWID_,2); END;
CREATE TRIGGER "st_update_trigger_members_gis_SHAPE" AFTER UPDATE OF SHAPE ON members_gis WHEN OLD._ROWID_ = NEW._ROWID_ BEGIN SELECT UpdateIndexEntry ("st_spindex__members_gis_SHAPE",NEW.SHAPE,NEW._ROWID_,2); END;
UPDATE "GDB_TableRegistry" set object_flags=278535 where table_name='members_gis';
insert into "GDB_ServiceItems"("OBJECTID", "DatasetName", "ItemType", "ItemId", "ItemInfo", "AdvancedDrawingInfo")values((select max(OBJECTID)+1 from "GDB_ServiceItems"),'bristowward',0,-1,'{"initialExtent": {"xmin": -8636545.212048769, "ymin": 4664046.391477494, "ymax": 4685963.304792815, "xmax": -8610898.279003477, "spatialReference": {"wkid": 102100, "latestWkid": 3857}}, "spatialReference": {"wkid": 102100, "latestWkid": 3857}, "size": 1163264, "layers": [{"xssTrustedFields": "", "name": "members_gis", "tableName": "members_gis", "layerId": 0, "type": "Feature Layer", "id": 8}], "isEnabled": true, "capabilities": "Create,Delete,Query,Update,Editing,Sync", "publishJobId": "956aad04-31cc-4b8d-af6c-a4f442c02674", "units": "esriMeters", "xssPreventionInfo": {"xssInputRule": "rejectInvalid", "xssPreventionRule": "InputOnly", "xssPreventionEnabled": true}, "type": "FeatureServer", "isView": false, "maxRecordCount": 1000, "allowGeometryUpdates": true, "description": "Contains member list", "hasStaticData": false, "hasViews": false, "fullExtent": {"xmin": -8636545.212048769, "ymin": 4664046.391477494, "ymax": 4685963.304792815, "xmax": -8610898.279003477, "spatialReference": {"wkid": 102100, "latestWkid": 3857}}, "editorTrackingInfo": {"enableEditorTracking": true, "allowAnonymousToDelete": true, "allowOthersToDelete": true, "allowOthersToUpdate": true, "allowOthersToQuery": true, "enableOwnershipAccessControl": false, "allowAnonymousToUpdate": true}, "syncEnabled": true, "name": "Members", "provider": "mtsds", "copyrightText": "", "syncIsReady": true, "datasource": "db", "serviceDescription": "List of members", "serviceItemId": "351555bd51ae43d9aafa74d3c667d0c4"}',NULL);
update "GDB_Items" set Definition=replace(Definition,'<ChangeTracked>false</ChangeTracked>','<ChangeTracked>true</ChangeTracked>') where "Name" !='main.members_gis__ATTACHREL';
update "GDB_ServiceItems" set "ItemInfo" = replace("ItemInfo",'Create,Delete,Query,Update,Editing','Create,Delete,Query,Update,Editing,Sync') where "ItemInfo" like '%Create,Delete,Query,Update,Editing"%';
update "GDB_ServiceItems" set "ItemInfo"=replace("ItemInfo",'"hasAttachments":true','"hasAttachments":true,"attachmentProperties":[{"name":"name","isEnabled":true},{"name":"size","isEnabled":true},{"name":"contentType","isEnabled":true},{"name":"keywords","isEnabled":true}]');
update "GDB_ColumnRegistry" set object_flags=4 where table_name='GDB_ServiceItems' and column_name in('DatasetName','ItemType','ItemId','ItemInfo');
PRAGMA writable_schema=ON;;
delete FROM sqlite_master where type='trigger' and name like '%_Shape';
PRAGMA writable_schema=OFF;;
update "GDB_ServiceItems" set "ItemInfo"=replace("ItemInfo",'"capabilities":"Query"','"capabilities":"Create,Delete,Query,Update,Editing,Sync"');